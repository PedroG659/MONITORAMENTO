# default.conf - configuração do NGINX como proxy reverso
# Este arquivo configura um server que encaminha tráfego HTTP para o serviço do app


server {
listen 80; # porta HTTP padrão


# server_name pode ser usado em produção; para o Kubernetes, normalmente se usa o service name
server_name _;


# Rota raiz encaminha para o serviço 'node-app' (nome do service Kubernetes)
location / {
# proxy_pass usa o nome do service e porta definida no Service k8s
proxy_pass http://node-app-service:3000;


# Cabeçalhos recomendados para passar informações ao backend
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
}


# Opcional: rota /metrics também pode ser encaminhada (se Prometheus scrapear via nginx)
location /metrics {
proxy_pass http://node-app-service:3000/metrics;
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
}
}